<div class="container">
  <div class="container-item">
    <span class="bold p-3">Subscriptions</span>
  </div>
  <div class="p-3">
    <div *ngFor="let subscription of keptnService.subscriptions; let $index = index">
      <div fxLayout="row" fxLayoutGap="10px">
        <button fxFlex="1" class="inline small mr-2" dt-show-more [showLess]="subscriptionInfo.expanded" (click)="subscriptionInfo.toggle();"></button>
        <ktb-subscription-item [subscription]="subscription" [isReadOnly]="!subscriptionInfo.expanded"></ktb-subscription-item>
        <a fxFlex="1" href="javascript:void(0)" title="Delete subscription" (click)="keptnService.deleteSubscription($index)"><dt-icon class="dt-icon" name="delete"></dt-icon></a>
      </div>
      <dt-expandable-panel #subscriptionInfo class="ml-3">
        <p class="bold">Parameters:</p>
        <div fxLayout="row" fxLayoutGap="10px" class="mt-2" *ngFor="let pair of subscription.parameters; let $index = index">
          <span fxFlex="30px">Key:</span><input fxFlex="15" dtInput [(ngModel)]="pair.key">
          <span fxFlex="35px">Value:</span>
          <div fxFlex="15">
            <input *ngIf="pair.visible; else disabledInput" dtInput [(ngModel)]="pair.value">
            <ng-template #disabledInput>
              <input dtInput [value]="pair.key" [disabled]="true" />
            </ng-template>
          </div>
          <a class="ml-2" href="javascript:void(0)" (click)="pair.visible = !pair.visible"><dt-icon *ngIf="pair.visible" [name]="'overview'"></dt-icon><dt-icon *ngIf="!pair.visible" [name]="'dont-watch'"></dt-icon></a>
          <a class="ml-2" href="javascript:void(0)" title="Delete parameter" (click)="subscription.deleteParameter($index)"><dt-icon class="dt-icon" name="delete"></dt-icon></a>
        </div>
        <a href="javascript:void(0)" title="Add parameter" (click)="subscription.addParameter()"><dt-icon class="dt-icon" name="addrowonbottom"></dt-icon></a>
      </dt-expandable-panel>
    </div>
    <div xLayout="row" fxLayoutGap="10px">
      <dt-icon fxFlex="1" name="minus"></dt-icon>
      <ktb-subscription-item [subscription]="newSubscription"></ktb-subscription-item>
      <a fxFlex="1" href="javascript:void(0)" title="Add subscription" (click)="addSubscription()"><dt-icon class="dt-icon" name="plus-add"></dt-icon></a>
    </div>
    <button class="mt-3 mb-3" dt-button (click)="updateSubscriptions()">Update subscriptions</button>
  </div>
</div>
